
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://pybit.es/theme/stylesheet/style.min.css">
  <link rel="stylesheet" type="text/css" href="https://pybit.es/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://pybit.es/theme/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css">
  <link rel="stylesheet" type="text/css" href="https://pybit.es/theme/stylesheet/ribbons.css">
  <link rel="stylesheet" type="text/css" href="https://pybit.es/theme/stylesheet/custom.css">

    <link href="https://pybit.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyBites Atom">

    <link href="https://pybit.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyBites RSS">

    <link rel="shortcut icon" href="https://pybit.es/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://pybit.es/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Bob" />
<meta name="description" content="You probably remember your first script. I remember the joy of discovering how I could let the machine automate something for me. It still gets me excited everyday. I played a bit with openpyxl yesterday. I used it to hack an Excel game for which I first used a macro. Not particularly useful but a nice exploration of this module." />
<meta name="keywords" content="excel, games, first script, vba, automation, openpyxl, hacking, unix">
<meta property="og:site_name" content="PyBites"/>
<meta property="og:title" content="Module of the Week: Openpyxl - Automate Excel!"/>
<meta property="og:description" content="You probably remember your first script. I remember the joy of discovering how I could let the machine automate something for me. It still gets me excited everyday. I played a bit with openpyxl yesterday. I used it to hack an Excel game for which I first used a macro. Not particularly useful but a nice exploration of this module."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://pybit.es/python-openpyxl.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-09-12 10:50:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://pybit.es/author/bob.html">
<meta property="article:section" content="Modules"/>
<meta property="article:tag" content="excel"/>
<meta property="article:tag" content="games"/>
<meta property="article:tag" content="first script"/>
<meta property="article:tag" content="vba"/>
<meta property="article:tag" content="automation"/>
<meta property="article:tag" content="openpyxl"/>
<meta property="article:tag" content="hacking"/>
<meta property="article:tag" content="unix"/>
<meta property="og:image" content="https://pybit.es/images/featured/pb-article.png">

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@pybites" />
<meta name="twitter:title" content="Module of the Week: Openpyxl - Automate Excel!" />
<meta name="twitter:description" content="You probably remember your first script. I remember the joy of discovering how I could let the machine automate something for me. It still gets me excited everyday. I played a bit with openpyxl yesterday. I used it to hack an Excel game for which I first used a macro. Not particularly useful but a nice exploration of this module." />
<meta name="twitter:image" content="https://pybit.es/images/featured/pb-article.png">

  <title>PyBites &ndash; Module of the Week: Openpyxl - Automate Excel!</title>


</head>
<body>

  <!-- change ribbon color based on topic -->
  <div class="ribbon right
      blue
  ">
    <a href="https://codechalleng.es" target="_blank">Click here to code!</a>
  </div>

  <!-- change aside color based on topic -->
    <aside class='blue'>
  
    <div>
      <a href="https://pybit.es">
          <img src="https://pybit.es/theme/img/article.png" alt="PyBites" title="PyBites">
      </a>
      <h1><a href="https://pybit.es">PyBites</a></h1>

<p>Python Code Challenges, Articles and News - One Bite a Day</p>
      <nav>
        <ul class="list">
          <li><a href="https://pybit.es/pages/about.html">About</a></li>
          <li><a href="https://pybit.es/pages/articles.html">Articles</a></li>
          <li><a href="https://pybit.es/pages/challenges.html">Challenges</a></li>
          <li><a href="https://pybit.es/pages/courses.html">Courses</a></li>
          <li><a href="https://pybit.es/pages/news.html">News</a></li>
          <li><a href="https://pybit.es/pages/projects.html">Projects</a></li>
          <li><a href="https://pybit.es/pages/search.html">Search</a></li>

        </ul>
      </nav>


	      <a class="twitter-follow-button" href="https://twitter.com/pybites" data-show-screen-name="false" data-size="large" data-show-count="false">Follow @pybites</a>

		    <a class="github-button" href="https://github.com/pybites" data-size="large" aria-label="Follow @pybites on GitHub">Follow</a>

      <br>
      <script src="https://apis.google.com/js/platform.js"></script>
      <div class="g-ytsubscribe" data-channelid="UCBn-uKDGsRBfcB0lQeOB_gA" data-layout="default" data-count="default"></div>

	
    </div>


  </aside>
  <main>


<article class="single">
  <header>
    <h1 id="python-openpyxl">Module of the Week: Openpyxl - Automate Excel!</h1>
    <p>
          Posted by <a href="https://pybit.es/author/bob.html">Bob</a> on Tue 12 September 2017 in <a href="https://pybit.es/category/modules.html">Modules</a>


        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p>You probably remember your first script. I remember the joy of discovering how I could let the machine automate something for me. It still gets me excited everyday. I played a bit with openpyxl yesterday. I used it to hack an Excel game for which I first used a macro. Not particularly useful but a nice exploration of this module.</p>
<h2>Hack the Game</h2>
<p>I wondered how easy it was to redo an Excel (VBA) macro in Python. So I used one of my my first scripts to hack <a href="http://juegosexcel.com/foro/viewtopic.php?t=6396">this Excel game</a>. More info <a href="https://bobbelderbos.com/2016/02/fired-up-about-programming/">here</a> including a story how I got into programming.</p>
<p>My first shot at it was <a href="http://www.lexicon.net/sjmachin/xlrd.html">xlrd</a> because the game was in <code>xls</code> but it got messy. Not giving in easily, I asked Julian to save it to <code>xlsx</code> because I don't have MS Excel (thanks buddy). </p>
<p>Attacking the problem with <a href="https://openpyxl.readthedocs.io/en/default/">openpyxl</a> was a much greater experience. You can find the code <a href="https://gist.github.com/pybites/e1c04368fd1bc994c6f2e3ef89e90dd4">here</a>. </p>
<p>What was fun and beyond the initial Macro solution:</p>
<ul>
<li>
<p>Apart from the 'save to xlsx' dependency it does not rely on macros, Python is more portable. It took me also far less time, even taking out the advantage of having more experience now.</p>
</li>
<li>
<p>As far as I know with Macros you have the same issue of the game creator hiding the answers, I was surprised that in Python I could just get the answers from the formulas that were visible querying the cells with conditional formatting. </p>
<p>In that regard you might not even need Python as I could also get the answers out of the spreadsheet using unix' <code>strings</code> + data cleaning. See here the cities in the right (zig zag) order:</p>
<div class="highlight"><pre><span></span>$ strings ciudades.xls <span class="p">|</span>grep -n -B10 -A300 AVILA <span class="p">|</span> grep -B1 CORR <span class="p">|</span> egrep -v <span class="s1">&#39;CORR|CASI|^\-\-&#39;</span><span class="p">|</span>sed <span class="s1">&#39;s/.*[-:]//g&#39;</span>
SANTANDER
AVILA
MURCIA
BADAJOZ
BILBAO
SEVILLA
...
...
</pre></div>


<p>Point being for as much as we love Python don't forget the power of Unix shell scripting for quick and one-off things!</p>
</li>
<li>
<p>As often concluded here: don't reinvent the wheel, often you can <a href="https://pypi.python.org/pypi">use a module</a>. In this case the openpyxl module makes querying, updating and saving the workbook a breeze.</p>
</li>
<li>
<p>The regex in <code>SOLUTION_FORMULA</code> was pretty useful to extract the destination cell and answer (city). Regexes are useful if you don't overdo them. We have <a href="https://pybit.es/mastering-regex.html">this resource</a> if you want to learn more about them. We will also dedicate <a href="https://pybit.es/pages/challenges.html">a code challenge</a> to regexes <a href="https://github.com/pybites/challenges/issues/96">at some point</a> so you can practice them ...</p>
</li>
<li>
<p>Another favorite of mine are <a href="https://docs.python.org/3.6/library/collections.html#collections.namedtuple">namedtuples</a> which <a href="https://pybit.es/beautiful-python.html">make your code more readable</a>.</p>
</li>
</ul>
<h2>Conclusion</h2>
<p>Lessons learned:</p>
<ul>
<li>
<p>When using Python to work with Excel sheets it's probably best to go with the newer <code>xlsx</code> format so you can use openpyxl.</p>
</li>
<li>
<p>Not all code exercises have to be useful per se. Apart from this article, with this exercise I got to practice just enough to feel confident doing more useful stuff with Excel + Python when needed.</p>
</li>
<li>
<p>For some things you actually don't need Python.</p>
</li>
<li>
<p>For me automating stuff has been (and still is) one of the best and most fun ways to learn coding.</p>
</li>
</ul>
<h2>Call out to Finance / Excel folks</h2>
<p>Let's do a challenge around this one! I logged <a href="https://github.com/pybites/challenges/issues/104">an issue</a>. If you have cool ideas what we can automate with Excel + Openpyxl update the issue. Thanks.</p>
<hr>
<p>Keep Calm and Code in Python!</p>
<p>-- Bob</p>
  </div>

  <hr>
  <p><strong>See an error in this post? Please submit a pull request <a href='https://github.com/pybites/pybites.github.io-src' target='_blank'>on Github.</a></strong></p>

<!-- Begin MailChimp Signup Form -->
<hr class="softDivider">
<div id="mc_embed_signup">
<form action="//pybit.us14.list-manage.com/subscribe/post?u=822043293f280259d4b8d2a3e&amp;id=ac7e2eb9ef" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
    
<div class="mc-field-group">
  <p><a href='http://us14.campaign-archive1.com/home/?u=822043293f280259d4b8d2a3e&id=ac7e2eb9ef'>Join our community</a> and grab our <i>Become a Better Python Developer</i> cheat sheet. Learn Python. Receive bonus material. Challenge yourself!</p>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_822043293f280259d4b8d2a3e_ac7e2eb9ef" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Join Us" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<!--End mc_embed_signup-->
  <div class="tag-cloud">
    <p>
      <a href="https://pybit.es/tag/excel.html">excel</a>
      <a href="https://pybit.es/tag/games.html">games</a>
      <a href="https://pybit.es/tag/first-script.html">first script</a>
      <a href="https://pybit.es/tag/vba.html">vba</a>
      <a href="https://pybit.es/tag/automation.html">automation</a>
      <a href="https://pybit.es/tag/openpyxl.html">openpyxl</a>
      <a href="https://pybit.es/tag/hacking.html">hacking</a>
      <a href="https://pybit.es/tag/unix.html">unix</a>
    </p>
  </div>

  <div class="center social-share">
    <p>    Like this article? Share it with your friends!
</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
  </div>



<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'http-pybit-es';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; pybites </p>
<p>    Powered by <a href="https://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-89294245-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

	<script>window.twttr = (function(d, s, id) {
	var js, fjs = d.getElementsByTagName(s)[0],
		t = window.twttr || {};
	if (d.getElementById(id)) return t;
	js = d.createElement(s);
	js.id = id;
	js.src = "https://platform.twitter.com/widgets.js";
	fjs.parentNode.insertBefore(js, fjs);
	t._e = [];
	t.ready = function(f) {
		t._e.push(f);
	};
	return t;
	}(document, "script", "twitter-wjs"));</script>

  <script async defer src="https://buttons.github.io/buttons.js"></script>
	
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5859c6a67eb6254d" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " PyBites ",
  "url" : "https://pybit.es",
  "image": "https://pybit.es/theme/img/profile.png",
  "description": "Python Code Challenges, Articles and News - One Bite a Day"
}
</script>
</body>
</html>